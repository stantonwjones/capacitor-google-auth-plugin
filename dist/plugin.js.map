{"version":3,"file":"plugin.js","sources":["esm/index.js","esm/web.js"],"sourcesContent":["import { registerPlugin } from '@capacitor/core';\nconst CapacitorGoogleAuth = registerPlugin('CapacitorGoogleAuth', {\n    web: () => import('./web').then((m) => new m.CapacitorGoogleAuthWeb()),\n});\nexport * from './definitions';\nexport { CapacitorGoogleAuth };\n//# sourceMappingURL=index.js.map","import { WebPlugin } from '@capacitor/core';\nexport class CapacitorGoogleAuthWeb extends WebPlugin {\n    constructor() {\n        super();\n        this.googleApiLoadedSuccessfully = () => { };\n        this.googleApiFailedToLoad = () => { };\n        this.googleApiLoaded = new Promise((resolve, reject) => {\n            this.googleApiLoadedSuccessfully = () => {\n                resolve();\n            };\n            this.googleApiFailedToLoad = () => reject();\n        });\n        console.log(\"constructor called\");\n        this.loadScript();\n    }\n    async authorize(options) {\n        await this.googleApiLoaded;\n        return new Promise(async (resolve, reject) => {\n            try {\n                google.accounts.id.initialize({\n                    client_id: options.clientId,\n                    callback: (googleUser) => {\n                        console.log(googleUser);\n                        resolve({ idToken: googleUser.credential });\n                        console.log({ idToken: googleUser.credential });\n                    },\n                });\n                google.accounts.id.prompt();\n            }\n            catch (error) {\n                reject(error);\n            }\n        });\n    }\n    // async refresh() {\n    //   const authResponse = await gapi.auth2.getAuthInstance().currentUser.get().reloadAuthResponse();\n    //   return {\n    //     accessToken: authResponse.access_token,\n    //     idToken: authResponse.id_token,\n    //     refreshToken: '',\n    //   };\n    // }\n    // async signOut() {\n    //   return gapi.auth2.getAuthInstance().signOut();\n    // }\n    // async addUserChangeListener() {\n    //   await this.gapiLoaded;\n    //   gapi.auth2.getAuthInstance().currentUser.listen((googleUser) => {\n    //     this.notifyListeners('userChange', googleUser.isSignedIn() ? this.getUserFrom(googleUser) : null);\n    //   });\n    // }\n    getUserFrom(googleUser) {\n        const user = {};\n        const profile = googleUser.getBasicProfile();\n        user.email = profile.getEmail();\n        user.familyName = profile.getFamilyName();\n        user.givenName = profile.getGivenName();\n        user.id = profile.getId();\n        user.imageUrl = profile.getImageUrl();\n        user.name = profile.getName();\n        const authResponse = googleUser.getAuthResponse(true);\n        user.accessToken = authResponse.access_token;\n        user.idToken = authResponse.id_token;\n        user.refreshToken = '';\n        return user;\n    }\n    // Dynamically loads google api scripts\n    loadScript() {\n        if (typeof document === 'undefined') {\n            return;\n        }\n        const scriptId = 'gapi';\n        const scriptEl = document === null || document === void 0 ? void 0 : document.getElementById(scriptId);\n        if (scriptEl) {\n            return;\n        }\n        const head = document.getElementsByTagName('head')[0];\n        const script = document.createElement('script');\n        script.type = 'text/javascript';\n        script.defer = true;\n        script.async = true;\n        script.id = scriptId;\n        script.onload = () => this.googleApiLoadedSuccessfully();\n        script.src = 'https://accounts.google.com/gsi/client';\n        head.appendChild(script);\n    }\n}\n//# sourceMappingURL=web.js.map"],"names":["registerPlugin","WebPlugin"],"mappings":"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"}